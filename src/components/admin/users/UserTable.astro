---
import type { User } from "@/services/userService";

interface Props {
	users: User[];
	currentUserId?: number;
}

const { users, currentUserId } = Astro.props;
---

<div
	class="bg-white rounded-3xl border border-secondary/5 shadow-sm overflow-hidden"
>
	<table class="w-full text-left">
		<thead>
			<tr class="bg-accent/5">
				<th
					class="px-8 py-4 text-[10px] font-bold uppercase tracking-widest text-secondary/40"
					>ID</th
				>
				<th
					class="px-8 py-4 text-[10px] font-bold uppercase tracking-widest text-secondary/40"
					>Nombre</th
				>
				<th
					class="px-8 py-4 text-[10px] font-bold uppercase tracking-widest text-secondary/40"
					>Email</th
				>
				<th
					class="px-8 py-4 text-[10px] font-bold uppercase tracking-widest text-secondary/40"
					>Rol</th
				>
				<th
					class="px-8 py-4 text-[10px] font-bold uppercase tracking-widest text-secondary/40"
					>Registro</th
				>
				<th
					class="px-8 py-4 text-[10px] font-bold uppercase tracking-widest text-secondary/40 text-right"
					>Acciones</th
				>
			</tr>
		</thead>
		<tbody class="divide-y divide-secondary/5">
			{
				users.map((user) => (
					<tr
						class="user-row hover:bg-accent/5 transition-colors group"
						data-name={user.name.toLowerCase()}
						data-email={user.email.toLowerCase()}
					>
						<td class="px-8 py-5 text-sm text-secondary/40 font-mono">
							#{user.id}
						</td>
						<td class="px-8 py-5">
							<div class="flex items-center gap-3">
								<div class="w-8 h-8 rounded-lg bg-secondary text-white flex items-center justify-center text-[10px] font-black shrink-0">
									{user.name.charAt(0).toUpperCase()}
								</div>
								<span class="font-bold text-sm text-secondary tracking-tight">
									{user.name}
								</span>
							</div>
						</td>
						<td class="px-8 py-5 text-sm text-secondary/60">
							{user.email}
						</td>
						<td class="px-8 py-5">
							<span
								class={`text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded-full border ${
									user.role === "admin"
										? "bg-primary/5 text-primary border-primary/10"
										: "bg-green-500/5 text-green-600 border-green-500/10"
								}`}
							>
								{user.role}
							</span>
						</td>
						<td class="px-8 py-5 text-sm text-secondary/40">
							{new Date(user.created_at).toLocaleDateString()}
						</td>
						<td class="px-8 py-5 text-right">
							<div class="flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
								<a
									href={`/admin/users/edit/${user.id}`}
									class="w-8 h-8 flex items-center justify-center rounded-lg bg-accent/50 text-secondary hover:bg-secondary hover:text-white transition-all shadow-sm"
									title="Editar"
								>
									<svg
										xmlns="http://www.w3.org/2000/svg"
										width="14"
										height="14"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2.5"
										stroke-linecap="round"
										stroke-linejoin="round"
									>
										<>
											<path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
											<path d="m15 5 4 4" />
										</>
									</svg>
								</a>
								<button
									class={`delete-user-btn w-8 h-8 flex items-center justify-center rounded-lg shadow-sm transition-all ${
										user.id === currentUserId
											? "bg-secondary/5 text-secondary/20 cursor-not-allowed opacity-50"
											: "bg-primary/5 text-primary hover:bg-primary hover:text-white cursor-pointer"
									}`}
									data-id={user.id}
									data-name={user.name}
									disabled={user.id === currentUserId}
									title={
										user.id === currentUserId
											? "No puedes eliminarte a ti mismo"
											: "Eliminar"
									}
								>
									<svg
										xmlns="http://www.w3.org/2000/svg"
										width="14"
										height="14"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2.5"
										stroke-linecap="round"
										stroke-linejoin="round"
									>
										<>
											<path d="M3 6h18" />
											<path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
											<path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
											<line
												x1="10"
												y1="11"
												x2="10"
												y2="17"
											/>
											<line
												x1="14"
												y1="11"
												x2="14"
												y2="17"
											/>
										</>
									</svg>
								</button>
							</div>
						</td>
					</tr>
				))
			}
		</tbody>
	</table>
</div>
