---
import CartManager from "./CartManager.vue";
import NavbarAuth from "./NavbarAuth.astro";
import NavbarMobileAuth from "./NavbarMobileAuth.astro";

const { pathname } = Astro.url;

const navLinks = [
	{ name: "Inicio", href: "/" },
	{ name: "Catálogo", href: "/catalog" },
	{ name: "Contacto", href: "/contact" },
];
---

<header
	class="fixed top-0 left-0 right-0 z-50 glass border-b border-secondary/5"
>
	<div class="container-custom py-4 flex items-center justify-between">
		<a href="/" class="flex items-center gap-2 relative z-50">
			<div
				class="w-10 h-10 bg-primary rounded flex items-center justify-center"
			>
				<span
					class="text-white font-black text-xl italic text-right -mr-1"
					>C</span
				>
				<span class="text-white font-black text-xl italic -ml-1">B</span
				>
			</div>
			<div class="flex flex-col leading-none">
				<span
					class="font-black text-xl tracking-tighter text-secondary uppercase"
					>CatByCam</span
				>
				<span
					class="text-[10px] text-primary font-bold uppercase tracking-widest"
					>Maquinaria Vial</span
				>
			</div>
		</a>

		<!-- Desktop Navigation -->
		<nav class="hidden md:flex items-center gap-8">
			{
				navLinks.map((link) => {
					const isActive =
						pathname === link.href ||
						(link.href !== "/" && pathname.startsWith(link.href));
					return (
						<a
							href={link.href}
							class={`text-sm font-bold transition-all duration-300 relative py-1 ${
								isActive
									? "text-primary px-2"
									: "text-secondary/70 hover:text-primary"
							}`}
						>
							{link.name}
							{isActive && (
								<span class="absolute bottom-0 left-0 w-full h-0.5 bg-primary rounded-full" />
							)}
						</a>
					);
				})
			}

			<div class="flex items-center gap-6">
				<CartManager client:load />

				<!-- Server Island: Auth state rendered on server -->
				<NavbarAuth server:defer>
					<div slot="fallback" class="flex items-center gap-4">
						<div
							class="w-8 h-8 bg-accent/50 rounded-full animate-pulse"
						>
						</div>
					</div>
				</NavbarAuth>
			</div>
		</nav>

		<!-- Mobile Menu Toggle -->
		<div class="flex items-center gap-4 md:hidden relative z-50">
			<CartManager client:load />
			<button
				id="mobile-menu-toggle"
				class="text-secondary p-2 -mr-2 cursor-pointer outline-none"
			>
				<svg
					id="menu-icon-open"
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2.5"
					stroke-linecap="round"
					stroke-linejoin="round"
					><line x1="3" y1="12" x2="21" y2="12"></line><line
						x1="3"
						y1="6"
						x2="21"
						y2="6"></line><line x1="3" y1="18" x2="21" y2="18"
					></line></svg
				>
				<svg
					id="menu-icon-close"
					class="hidden"
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2.5"
					stroke-linecap="round"
					stroke-linejoin="round"
					><line x1="18" y1="6" x2="6" y2="18"></line><line
						x1="6"
						y1="6"
						x2="18"
						y2="18"></line></svg
				>
			</button>
		</div>
	</div>

	<!-- Mobile Menu Overlay -->
	<div
		id="mobile-menu"
		class="fixed inset-0 bg-white h-screen z-40 transform translate-x-full transition-transform duration-500 ease-in-out md:hidden"
	>
		<div class="flex flex-col h-full pt-32 px-8 pb-12">
			<div class="flex flex-col gap-6 mb-12">
				<span
					class="text-[10px] uppercase font-bold tracking-[0.3em] text-secondary/30 mb-2"
					>Navegación</span
				>
				{
					navLinks.map((link) => {
						const isActive =
							pathname === link.href ||
							(link.href !== "/" &&
								pathname.startsWith(link.href));
						return (
							<a
								href={link.href}
								class={`text-3xl font-black transition-all ${
									isActive
										? "text-primary translate-x-2"
										: "text-secondary opacity-60 hover:opacity-100"
								}`}
							>
								{link.name}
							</a>
						);
					})
				}
			</div>

			<div class="mt-auto border-t border-secondary/5 pt-12">
				<!-- Server Island: Mobile Auth state -->
				<NavbarMobileAuth server:defer>
					<div slot="fallback" class="space-y-4">
						<div
							class="h-16 bg-accent/50 rounded-2xl animate-pulse"
						>
						</div>
					</div>
				</NavbarMobileAuth>
			</div>
		</div>
	</div>
</header>

<script is:inline>
	(function () {
		const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
		const mobileMenu = document.getElementById("mobile-menu");
		const openIcon = document.getElementById("menu-icon-open");
		const closeIcon = document.getElementById("menu-icon-close");

		if (mobileMenuToggle && mobileMenu) {
			mobileMenuToggle.addEventListener("click", () => {
				const isOpen =
					!mobileMenu.classList.contains("translate-x-full");
				if (isOpen) {
					mobileMenu.classList.add("translate-x-full");
					openIcon.classList.remove("hidden");
					closeIcon.classList.add("hidden");
					document.body.style.overflow = "";
				} else {
					mobileMenu.classList.remove("translate-x-full");
					openIcon.classList.add("hidden");
					closeIcon.classList.remove("hidden");
					document.body.style.overflow = "hidden";
				}
			});
		}
	})();
</script>
