---
import { UserService } from "@/services/userService";

export const prerender = false;

const currentUser = Astro.locals.user!;

if (Astro.request.method === "POST") {
	const formData = await Astro.request.formData();
	const id = formData.get("id")?.toString();

	if (id && currentUser) {
		// Prevent deleting yourself
		if (id === currentUser.id.toString()) {
			return Astro.redirect("/admin/users?error=self-delete");
		}

		await UserService.deleteUser(id);
	}
}

return Astro.redirect("/admin/users");
---
