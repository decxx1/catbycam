---
export const prerender = false;
import Layout from "@/layouts/Layout.astro";
import { getSession } from "@/utils/auth";
import { UserService } from "@/services/userService";
import ProfileBody from "@/components/web/profile/ProfileBody.astro";

const token = Astro.cookies.get("auth_token")?.value;
const session = token ? await getSession(token) : null;

if (!session) {
	return Astro.redirect("/login");
}

const user = await UserService.findById(session.userId);

if (!user) {
	Astro.cookies.delete("auth_token");
	return Astro.redirect("/login");
}
---

<Layout title="Mi Perfil">
	<section class="min-h-screen pt-40 pb-20 bg-accent/20">
		<div class="container-custom">
			<ProfileBody user={user} />
		</div>
	</section>
</Layout>
